{
  "openapi": "3.0.0",
  "info": {
    "title": "SignalK Units Preference API",
    "version": "1.0.0",
    "description": "API for managing unit conversions and display preferences for SignalK data paths"
  },
  "servers": [
    {
      "url": "/plugins/signalk-units-preference"
    }
  ],
  "paths": {
    "/conversion/{path}": {
      "get": {
        "summary": "Get conversion information for a path",
        "description": "Returns the conversion configuration for a specific SignalK path based on user preferences",
        "parameters": [
          {
            "name": "path",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "SignalK path (e.g., navigation.speedOverGround)"
          }
        ],
        "responses": {
          "200": {
            "description": "Conversion information",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConversionResponse"
                }
              }
            }
          },
          "404": {
            "description": "No conversion found for path"
          }
        }
      }
    },
    "/metadata": {
      "get": {
        "summary": "Get all unit metadata",
        "description": "Returns all unit metadata definitions",
        "responses": {
          "200": {
            "description": "All metadata",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": {
                    "$ref": "#/components/schemas/UnitMetadata"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/metadata/{path}": {
      "get": {
        "summary": "Get metadata for a specific path",
        "parameters": [
          {
            "name": "path",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Path metadata",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UnitMetadata"
                }
              }
            }
          },
          "404": {
            "description": "No metadata found for path"
          }
        }
      },
      "post": {
        "summary": "Create or update metadata for a path",
        "parameters": [
          {
            "name": "path",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UnitMetadata"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Metadata updated successfully"
          },
          "400": {
            "description": "Invalid metadata format"
          }
        }
      }
    },
    "/preferences": {
      "get": {
        "summary": "Get all preferences",
        "description": "Returns all category and path-specific preferences",
        "responses": {
          "200": {
            "description": "All preferences",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UnitsPreferences"
                }
              }
            }
          }
        }
      }
    },
    "/preferences/category/{category}": {
      "put": {
        "summary": "Update category preference",
        "parameters": [
          {
            "name": "category",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Category name (e.g., speed, temperature)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CategoryPreference"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Preference updated successfully"
          },
          "400": {
            "description": "Invalid preference format"
          }
        }
      }
    },
    "/preferences/path/{path}": {
      "put": {
        "summary": "Update path-specific preference override",
        "parameters": [
          {
            "name": "path",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CategoryPreference"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Override updated successfully"
          },
          "400": {
            "description": "Invalid preference format"
          }
        }
      },
      "delete": {
        "summary": "Delete path-specific preference override",
        "parameters": [
          {
            "name": "path",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Override deleted successfully"
          }
        }
      }
    },
    "/conversion/{path}/{unit}": {
      "post": {
        "summary": "Add custom conversion to a path",
        "parameters": [
          {
            "name": "path",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "unit",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Unit name (e.g., knots, mph)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConversionDefinition"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Conversion added successfully"
          },
          "400": {
            "description": "Invalid conversion format"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ConversionResponse": {
        "type": "object",
        "properties": {
          "path": {
            "type": "string",
            "description": "SignalK path"
          },
          "baseUnit": {
            "type": "string",
            "nullable": true,
            "description": "Base unit (SI or custom)"
          },
          "targetUnit": {
            "type": "string",
            "description": "Target unit for display"
          },
          "factor": {
            "type": "number",
            "description": "Conversion factor from base to target"
          },
          "inverseFactor": {
            "type": "number",
            "description": "Inverse factor from target to base"
          },
          "displayFormat": {
            "type": "string",
            "description": "Display format (e.g., 0.0)"
          },
          "symbol": {
            "type": "string",
            "description": "Symbol for target unit"
          },
          "category": {
            "type": "string",
            "description": "Category of measurement"
          }
        }
      },
      "UnitMetadata": {
        "type": "object",
        "properties": {
          "baseUnit": {
            "type": "string",
            "nullable": true,
            "description": "Base unit (SI or custom)"
          },
          "category": {
            "type": "string",
            "description": "Category of measurement"
          },
          "conversions": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/ConversionDefinition"
            }
          },
          "userDefinedUnit": {
            "type": "string",
            "description": "Custom unit for paths without schema"
          }
        }
      },
      "ConversionDefinition": {
        "type": "object",
        "required": ["factor", "symbol"],
        "properties": {
          "factor": {
            "type": "number",
            "description": "Multiplication factor from base to target"
          },
          "symbol": {
            "type": "string",
            "description": "Unit symbol"
          },
          "inverseFactor": {
            "type": "number",
            "description": "Inverse factor (optional, calculated if not provided)"
          }
        }
      },
      "CategoryPreference": {
        "type": "object",
        "required": ["targetUnit", "displayFormat"],
        "properties": {
          "targetUnit": {
            "type": "string",
            "description": "Target unit to display"
          },
          "displayFormat": {
            "type": "string",
            "description": "Display format (e.g., 0.0, 0.00)"
          }
        }
      },
      "UnitsPreferences": {
        "type": "object",
        "properties": {
          "categories": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/CategoryPreference"
            }
          },
          "pathOverrides": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/CategoryPreference"
            }
          }
        }
      }
    }
  }
}
