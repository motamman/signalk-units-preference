<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignalK Units Preference Manager</title>
    <link rel="icon" type="image/png" href="units.png">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #FAC10F 0%, #977408 100%);
            color: #241c00;
            padding: 20px 0;
            margin-bottom: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: black;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 0;
            overflow-x: auto;
        }

        .tab {
            background: #f8f9fa;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-radius: 0;
            transition: all 0.3s;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            margin: 0;
        }

        .tab:first-child {
            border-radius: 10px 0 0 0;
        }

        .tab:last-child {
            border-radius: 0 10px 0 0;
        }

        .tab:hover {
            background: #e9ecef;
            color: #333;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content .section {
            margin-bottom: 0;
            box-shadow: none;
            border-radius: 0;
            padding: 30px 0;
        }

        .tab-content .section:first-child {
            padding-top: 0;
        }

        .category-list, .override-list {
            display: grid;
            gap: 15px;
        }

        .category-item {
            border-radius: 6px;
        }

        .override-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .override-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .category-name, .path-name {
            font-weight: 600;
            color: #2c3e50;
            font-family: monospace;
        }

        .form-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 14px;
            color: #5a6c7d;
            margin-bottom: 5px;
        }

        .input-group input,
        .input-group select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: #667eea;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            background: #5a6fd8;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-edit {
            padding: 4px 12px;
            font-size: 12px;
            margin-right: 5px;
        }

        .btn-delete {
            padding: 4px 12px;
            font-size: 12px;
        }

        .add-override {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .tooltip-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
            cursor: help;
            position: relative;
        }

        .tooltip-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            white-space: normal;
            max-width: 300px;
            width: max-content;
            font-size: 13px;
            font-weight: normal;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            line-height: 1.4;
        }

        .tooltip-icon.tooltip-left:hover::after {
            left: 0;
            transform: translateX(0);
        }

        .tooltip-icon.tooltip-left:hover::before {
            left: 20px;
            transform: translateX(0);
        }

        .tooltip-icon.tooltip-right:hover::after {
            left: auto;
            right: 0;
            transform: translateX(0);
        }

        .tooltip-icon.tooltip-right:hover::before {
            left: auto;
            right: 20px;
            transform: translateX(0);
        }

        .tooltip-icon:hover::before {
            content: '';
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #2c3e50;
            z-index: 1000;
        }

        .status-message {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-message.show {
            display: block;
        }

        .loader {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        /* Path Tree Styles */
        .path-tree-container {
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            max-height: 400px;
            overflow-y: auto;
            padding: 8px;
            margin-bottom: 10px;
        }

        .path-tree-search {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .path-tree-node {
            margin-left: 20px;
        }

        .path-tree-item {
            padding: 4px 8px;
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .path-tree-item:hover {
            background: #f0f8ff;
        }

        .path-tree-item.selected {
            background: #d0e8ff;
            font-weight: 500;
        }

        .path-tree-item.has-value {
            color: #0066cc;
        }

        .path-tree-toggle {
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
        }

        .path-tree-children {
            margin-left: 20px;
            display: none;
        }

        .path-tree-children.expanded {
            display: block;
        }

        .path-tree-label {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .metadata-sortable-header:hover {
            background: #e9ecef;
        }

        .metadata-sortable-header .sort-arrow {
            color: #667eea;
            font-size: 10px;
        }

        /* Collapsible Section Styles */
        .collapsible-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 6px;
            transition: background-color 0.3s;
            user-select: none;
            margin-bottom: 15px;
        }

        .collapsible-header:hover {
            background: #e9ecef;
        }

        .collapsible-header h2 {
            margin: 0;
            font-size: 1.2rem;
        }

        .collapse-icon {
            font-size: 1.2rem;
            transition: transform 0.3s;
            color: #667eea;
        }

        .collapse-icon.collapsed {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 2000px;
            opacity: 1;
        }

        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
        }

        .category-item .collapsible-header {
            padding: 15px;
            margin-bottom: 0;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px 6px 0 0;
        }

        .category-item .collapsible-header:hover {
            background: #e9ecef;
        }

        .category-item .collapsible-header h3 {
            margin: 0;
            font-size: 1rem;
        }

        .category-item .collapsible-content {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-top: none;
            border-radius: 0 0 6px 6px;
            padding: 15px;
        }

        .category-item .collapsible-content.collapsed {
            padding: 0;
            border: none;
        }

        .category-item:has(.collapsible-content:not(.collapsed)) .collapsible-header {
            border-radius: 6px 6px 0 0;
        }

        .category-item:has(.collapsible-content.collapsed) .collapsible-header {
            border-radius: 6px;
        }

        .category-item [id^="category-edit-"] > div {
            background: #fff3cd;
            padding: 15px;
            border-radius: 4px;
            border: 1px dashed #ffc107;
        }

        .category-item [id^="category-edit-"] h4 {
            margin: 0 0 15px 0;
            color: #856404;
            font-size: 14px;
        }

        /* Unit Definition Item Styles */
        .unit-definition-item {
            border-radius: 6px;
        }

        .unit-definition-item .collapsible-header {
            padding: 15px;
            margin-bottom: 0;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px 6px 0 0;
        }

        .unit-definition-item .collapsible-header:hover {
            background: #e9ecef;
        }

        .unit-definition-item .collapsible-header h3 {
            margin: 0;
            font-size: 1rem;
        }

        .unit-definition-item .collapsible-content {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-top: none;
            border-radius: 0 0 6px 6px;
            padding: 15px;
        }

        .unit-definition-item .collapsible-content.collapsed {
            padding: 0;
            border: none;
        }

        .unit-definition-item:has(.collapsible-content:not(.collapsed)) .collapsible-header {
            border-radius: 6px 6px 0 0;
        }

        .unit-definition-item:has(.collapsible-content.collapsed) .collapsible-header {
            border-radius: 6px;
        }

        /* Pattern Item Styles */
        .pattern-item {
            border-radius: 6px;
        }

        .pattern-item .collapsible-header {
            padding: 15px;
            margin-bottom: 0;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px 6px 0 0;
        }

        .pattern-item .collapsible-header:hover {
            background: #e9ecef;
        }

        .pattern-item .collapsible-header h3 {
            margin: 0;
            font-size: 1rem;
        }

        .pattern-item .collapsible-content {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-top: none;
            border-radius: 0 0 6px 6px;
            padding: 15px;
        }

        .pattern-item .collapsible-content.collapsed {
            padding: 0;
            border: none;
        }

        .pattern-item:has(.collapsible-content:not(.collapsed)) .collapsible-header {
            border-radius: 6px 6px 0 0;
        }

        .pattern-item:has(.collapsible-content.collapsed) .collapsible-header {
            border-radius: 6px;
        }

        .pattern-item [id^="pattern-edit-"] > div {
            background: #fff3cd;
            padding: 15px;
            border-radius: 4px;
            border: 1px dashed #ffc107;
        }

        .pattern-item [id^="pattern-edit-"] h4 {
            margin: 0 0 15px 0;
            color: #856404;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                flex: 1;
                min-width: 120px;
                padding: 12px 15px;
                font-size: 13px;
            }

            .tab:first-child,
            .tab:last-child {
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <img src="units.png" alt="Units" style="height: 80px; vertical-align: middle; margin-right: 10px; border-radius: 5px;">
                SignalK Units Display Preference Manager
            </h1>
            <p>Configure unit conversions and display preferences</p>
        <p><strong>Important:</strong> This only changes how conversions are managed inside this tool. It won’t modify any existing SignalK apps, though it could be used as conversion manager for other apps. For now, it is just for testing.</p>
        
        </div>

        <div id="statusMessage" class="status-message"></div>

        <div class="tabs">
            <button class="tab active" data-tab="categories">Category Preferences</button>
            <button class="tab" data-tab="units">Unit Definitions</button>
            <button class="tab" data-tab="patterns">Path Patterns</button>
            <button class="tab" data-tab="overrides">Path Overrides</button>
            <button class="tab" data-tab="metadata">Metadata</button>
            <button class="tab" data-tab="settings">Settings</button>
        </div>

        <div id="categories" class="tab-content active">
            <div class="section">
                <div class="collapsible-header" onclick="toggleCollapsible('addCategoryContent')">
                    <h2>Add Custom Category</h2>
                    <span class="collapse-icon collapsed">▼</span>
                </div>
                <div id="addCategoryContent" class="collapsible-content collapsed">
                    <p style="color: #7f8c8d; margin-bottom: 20px;">
                        Create a custom category with its own base unit and default target unit.
                    </p>
                    <div class="add-override" style="grid-template-columns: 1fr 1fr 1fr 1fr auto;">
                        <div class="input-group">
                            <label>Category Name</label>
                            <input type="text" id="newCategoryName" placeholder="e.g., fuelConsumption">
                        </div>
                        <div class="input-group">
                            <label>Base Unit</label>
                            <div id="newCategoryBaseContainer"></div>
                            <input type="text" id="newCategoryBaseCustom" placeholder="Enter custom base unit" style="display: none; margin-top: 5px;">
                        </div>
                        <div class="input-group">
                            <label>Target Unit</label>
                            <div id="newCategoryTargetContainer"></div>
                            <input type="text" id="newCategoryTargetCustom" placeholder="Enter custom target unit" style="display: none; margin-top: 5px;">
                        </div>
                        <div class="input-group">
                            <label>Display Format</label>
                            <input type="text" id="newCategoryFormat" placeholder="e.g., 0.0" value="0.0">
                        </div>
                        <button class="btn-success" onclick="addCustomCategory()">Add Category</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Category Preferences</h2>
                <p style="color: #7f8c8d; margin-bottom: 20px;">
                    Set default units for each category. These apply to all paths unless overridden.
                </p>
                <div id="currentPreset" style="margin-bottom: 20px;"></div>
                <div id="categoryList" class="category-list loader">Loading...</div>
            </div>
        </div>

        <div id="patterns" class="tab-content">
            <div class="section">
                <div class="collapsible-header" onclick="toggleCollapsible('addPatternContent')">
                    <h2>Add Path Pattern</h2>
                    <span class="collapse-icon collapsed">▼</span>
                </div>
                <div id="addPatternContent" class="collapsible-content collapsed">
                    <p style="color: #7f8c8d; margin-bottom: 20px;">
                        Define patterns to automatically categorize paths. Use ** for wildcards (e.g., **.temperature, environment.**)
                    </p>
                    <div class="add-override">
                        <div style="display: grid; grid-template-columns: 2fr 1.5fr 1.5fr 1fr 0.8fr; gap: 15px; margin-bottom: 15px;">
                            <div class="input-group">
                                <label>
                                    Pattern
                                    <span class="tooltip-icon tooltip-left" data-tooltip="Use ** for multi-segment wildcard, * for single segment. Example: **.temperature matches any path ending in .temperature">?</span>
                                </label>
                                <input type="text" id="newPatternPattern" placeholder="e.g., **.temperature">
                            </div>
                            <div class="input-group">
                                <label>Category</label>
                                <div id="newPatternCategoryContainer"></div>
                                <input type="text" id="newPatternCategoryCustom" placeholder="Enter custom category name" style="display: none; margin-top: 5px;">
                            </div>
                            <div class="input-group" id="newPatternBaseGroup" style="display: none;">
                                <label>Base Unit (required for custom category)</label>
                                <div id="newPatternBaseContainer"></div>
                                <input type="text" id="newPatternBaseCustom" placeholder="Enter custom base unit" style="display: none; margin-top: 5px;">
                            </div>
                            <div class="input-group">
                                <label>Target Unit <span id="targetUnitLabel">(optional)</span></label>
                                <div id="newPatternTargetContainer"></div>
                                <input type="text" id="newPatternTargetCustom" placeholder="Enter custom target unit" style="display: none; margin-top: 5px;">
                                <small style="color: #7f8c8d; display: block; margin-top: 3px;" id="targetUnitHelp">Leave empty to use category default</small>
                            </div>
                            <div class="input-group">
                                <label>Display Format (optional)</label>
                                <input type="text" id="newPatternFormat" placeholder="e.g., 0.0">
                                <small style="color: #7f8c8d; display: block; margin-top: 3px;">Leave empty to use category default</small>
                            </div>
                            <div class="input-group">
                                <label>
                                    Priority
                                    <span class="tooltip-icon tooltip-right" data-tooltip="Higher numbers = checked first. Use to control which pattern matches when multiple patterns could apply">?</span>
                                </label>
                                <input type="number" id="newPatternPriority" placeholder="100" value="100">
                            </div>
                        </div>
                        <button class="btn-success" onclick="addPattern()" style="width: auto; padding: 10px 24px;">Add Pattern</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="collapsible-header" onclick="toggleCollapsible('pathPatternsContent')">
                    <h2>Path Patterns</h2>
                    <span class="collapse-icon">▼</span>
                </div>
                <div id="pathPatternsContent" class="collapsible-content">
                    <p style="color: #7f8c8d; margin-bottom: 20px;">
                        Patterns are checked in priority order (higher = first). Example: *.temperature matches any path ending in .temperature
                    </p>
                    <div id="patternList" class="override-list loader">Loading...</div>
                </div>
            </div>
        </div>

        <div id="units" class="tab-content">
            <div class="section">
                <div class="collapsible-header" onclick="toggleCollapsible('addUnitDefinitionsContent')">
                    <h2>Add Unit Definitions</h2>
                    <span class="collapse-icon collapsed">▼</span>
                </div>
                <div id="addUnitDefinitionsContent" class="collapsible-content collapsed">
                    <h3 style="color: #667eea; margin-bottom: 10px; font-size: 1.2rem;">Add Base Unit</h3>
                    <p style="color: #7f8c8d; margin-bottom: 20px;">
                        Define a new base unit that can be used across paths.
                    </p>
                    <div class="add-override" style="display: grid; grid-template-columns: 2fr 3fr auto; gap: 15px; align-items: end; margin-bottom: 30px;">
                        <div class="input-group">
                            <label>Base Unit Symbol</label>
                            <input type="text" id="newBaseUnitSymbol" placeholder="e.g., L/h, bar, psi">
                        </div>
                        <div class="input-group">
                            <label>Description (optional)</label>
                            <input type="text" id="newBaseUnitDesc" placeholder="e.g., Liters per hour, Pressure">
                        </div>
                        <button class="btn-success" onclick="addBaseUnit()" style="padding: 10px 24px;">Add Base Unit</button>
                    </div>

                    <h3 style="color: #667eea; margin-bottom: 10px; font-size: 1.2rem;">Add Conversion Formula</h3>
                    <p style="color: #7f8c8d; margin-bottom: 20px;">
                        Add a conversion formula to an existing base unit.
                    </p>
                    <div class="add-override">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="input-group">
                                <label>Base Unit</label>
                                <div id="conversionBaseUnitContainer"></div>
                            </div>
                            <div class="input-group">
                                <label>Target Unit Name</label>
                                <input type="text" id="conversionTargetUnit" placeholder="e.g., gal/h, fahrenheit">
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="input-group">
                                <label>
                                    Formula (base → target)
                                    <span class="tooltip-icon" data-tooltip="JavaScript expression using 'value' variable. Example: value * 0.264172 to convert L/h to gal/h">?</span>
                                </label>
                                <input type="text" id="conversionFormula" placeholder="e.g., value * 0.264172">
                            </div>
                            <div class="input-group">
                                <label>
                                    Inverse Formula (target → base)
                                    <span class="tooltip-icon" data-tooltip="JavaScript expression to convert back. Example: value * 3.78541">?</span>
                                </label>
                                <input type="text" id="conversionInverseFormula" placeholder="e.g., value * 3.78541">
                            </div>
                            <div class="input-group">
                                <label>Symbol</label>
                                <input type="text" id="conversionSymbol" placeholder="e.g., gal/h, °F">
                            </div>
                        </div>
                        <button class="btn-success" onclick="addConversion()" style="padding: 10px 24px;">Add Conversion</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>All Unit Definitions</h2>
                <p style="color: #7f8c8d; margin-bottom: 20px;">
                    View all defined base units and their available conversions.
                </p>
                <div id="unitDefinitionsList" class="loader">Loading...</div>
            </div>
        </div>

        <div id="overrides" class="tab-content">
            <div class="section">
                <div class="collapsible-header" onclick="toggleCollapsible('addPathOverrideContent')">
                    <h2>Add Path Override</h2>
                    <span class="collapse-icon collapsed">▼</span>
                </div>
                <div id="addPathOverrideContent" class="collapsible-content collapsed">
                    <p style="color: #7f8c8d; margin-bottom: 20px;">
                        Assign units to specific paths that don't fit a pattern.
                    </p>
                    <div class="add-override" style="background: #f8f9fa; padding: 20px; border-radius: 6px; border: 1px solid #e9ecef;">
                        <div style="display: grid; grid-template-columns: 2.5fr 1fr 1fr 0.8fr; gap: 12px; margin-bottom: 15px;">
                            <div class="input-group" style="margin: 0; position: relative;">
                                <label style="font-weight: 500; margin-bottom: 6px; display: block; font-size: 13px;">Path</label>
                                <input type="text" id="overridePathSearch" class="path-tree-search" placeholder="🔍 Search paths..." style="width: 100%;">
                                <div id="overridePathTree" class="path-tree-container" style="display: none; position: absolute; z-index: 1000; background: white; border: 1px solid #dee2e6; border-radius: 4px; max-height: 300px; overflow-y: auto; width: 100%; margin-top: 2px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
                                <input type="hidden" id="selectedOverridePath">
                            </div>
                            <div class="input-group" style="margin: 0;">
                                <label style="font-weight: 500; margin-bottom: 6px; display: block; font-size: 13px;">Base Unit</label>
                                <div id="overrideBaseUnitContainer"></div>
                            </div>
                            <div class="input-group" style="margin: 0;">
                                <label style="font-weight: 500; margin-bottom: 6px; display: block; font-size: 13px;">Target Unit</label>
                                <div id="overrideTargetUnitContainer"></div>
                            </div>
                            <div class="input-group" style="margin: 0;">
                                <label style="font-weight: 500; margin-bottom: 6px; display: block; font-size: 13px;">Display Format</label>
                                <input type="text" id="overrideFormat" placeholder="e.g., 0.0" value="0.0" style="width: 100%;">
                            </div>
                        </div>
                        <button class="btn-success" onclick="addPathOverride()" style="padding: 10px 24px; width: 100%;">Add Override</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="collapsible-header" onclick="toggleCollapsible('pathOverridesContent')">
                    <h2>Path Overrides</h2>
                    <span class="collapse-icon">▼</span>
                </div>
                <div id="pathOverridesContent" class="collapsible-content">
                    <p style="color: #7f8c8d; margin-bottom: 20px;">
                        Specific path configurations that override pattern and category defaults.
                    </p>
                    <div id="pathOverridesList" class="loader">Loading...</div>
                </div>
            </div>
        </div>

        <div id="metadata" class="tab-content">
            <div class="section">
                <h2>All Paths - Metadata Reference</h2>
                <p style="color: #7f8c8d; margin-bottom: 20px;">
                    View all unit definitions and available conversions.
                </p>
                <div id="metadataList" class="loader">Loading...</div>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="section">
                <h2>Unit System Presets</h2>
                <p style="color: #7f8c8d; margin-bottom: 20px;">
                    Quickly configure all category preferences to use a standard unit system.
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;">
                    <button class="btn-primary" onclick="applyUnitPreset('metric')" style="padding: 20px; font-size: 16px;">
                        Reset to Metric
                    </button>
                    <button class="btn-primary" onclick="applyUnitPreset('imperial-us')" style="padding: 20px; font-size: 16px;">
                        Reset to Imperial (US)
                    </button>
                    <button class="btn-primary" onclick="applyUnitPreset('imperial-uk')" style="padding: 20px; font-size: 16px;">
                        Reset to Imperial (UK)
                    </button>
                </div>
            </div>

            <div class="section">
                <h2>Custom Presets</h2>
                <p style="color: #7f8c8d; margin-bottom: 20px;">
                    Your saved custom presets. These are created when you modify a preset and save it from the Categories tab.
                </p>
                <div id="customPresetsList" style="display: grid; gap: 15px;">
                    <div class="loader">Loading custom presets...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Toggle collapsible sections
        function toggleCollapsible(contentId) {
            const content = document.getElementById(contentId);
            const header = content.previousElementSibling;
            const icon = header.querySelector('.collapse-icon');

            content.classList.toggle('collapsed');
            icon.classList.toggle('collapsed');
        }

        // Toggle individual category item
        function toggleCategoryItem(categoryName) {
            const content = document.getElementById(`category-content-${categoryName}`);
            const icon = document.getElementById(`category-icon-${categoryName}`);

            if (content && icon) {
                content.classList.toggle('collapsed');
                icon.classList.toggle('collapsed');
            }
        }

        // Toggle unit item (defined here as well for initial load)
        function toggleUnitItem(baseUnit) {
            const content = document.getElementById(`unit-content-${baseUnit}`);
            const icon = document.getElementById(`unit-icon-${baseUnit}`);

            if (!content || !icon) return;

            const isCurrentlyCollapsed = content.classList.contains('collapsed');

            // Close all other units (accordion behavior)
            document.querySelectorAll('[id^="unit-content-"]').forEach(el => {
                if (el.id !== `unit-content-${baseUnit}`) {
                    el.classList.add('collapsed');
                }
            });
            document.querySelectorAll('[id^="unit-icon-"]').forEach(el => {
                if (el.id !== `unit-icon-${baseUnit}`) {
                    el.classList.add('collapsed');
                }
            });

            // Toggle current unit
            if (isCurrentlyCollapsed) {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
            }
        }

        // Toggle pattern item with accordion behavior (close all others)
        function togglePatternItem(index) {
            const content = document.getElementById(`pattern-content-${index}`);
            const icon = document.getElementById(`pattern-icon-${index}`);

            if (!content || !icon) return;

            const isCurrentlyCollapsed = content.classList.contains('collapsed');

            // Close all other patterns (accordion behavior)
            document.querySelectorAll('[id^="pattern-content-"]').forEach(el => {
                if (el.id !== `pattern-content-${index}`) {
                    el.classList.add('collapsed');
                }
            });
            document.querySelectorAll('[id^="pattern-icon-"]').forEach(el => {
                if (el.id !== `pattern-icon-${index}`) {
                    el.classList.add('collapsed');
                }
            });

            // Toggle current pattern
            if (isCurrentlyCollapsed) {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
            }
        }
    </script>
    <script src="app.js"></script>
    <script src="pathTree.js"></script>
</body>
</html>
